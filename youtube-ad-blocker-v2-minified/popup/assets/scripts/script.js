const dayLength=864e5,MessageTypeEnum={UPDATE_PLAY_SPEED:"UPDATE_PLAY_SPEED",PAGE_RELOAD_REQUEST:"PAGE_RELOAD_REQUEST",REQUEST_PICTURE_IN_PLAY:"REQUEST_PICTURE_IN_PLAY"},initialData={isExtensionEnabled:!0,videosSkipped:{today:0,week:0,month:0,total:0}},$=(e,t=!1)=>t?document.querySelectorAll(e):document.querySelector(e),getFirstDayOfWeek=e=>{const t=864e5*e.getDay();let a=new Date(e.getTime()-t+864e5);return a>e&&(a=new Date(a.getTime()-6048e5)),a},getTimestamps=()=>{const e=Date.now();return{today:e-e%864e5,firstDayOfWeek:getFirstDayOfWeek(new Date(e)).getTime(),firstDayOfMonth:new Date(new Date(e).getFullYear(),new Date(e).getMonth(),1).getTime()}},saveData=(e,t)=>{try{if(!t||"object"!=typeof t)throw new Error("Invalid data format");chrome.storage.local.set({[e]:JSON.stringify(t)})}catch(e){console.error(`Error saving data: ${e.message}`)}},askAllYoutubeTabsToReload=e=>{chrome.tabs.query({url:"https://www.youtube.com/*"},t=>{t.forEach(t=>{chrome.tabs.sendMessage(t.id,{messageType:MessageTypeEnum.PAGE_RELOAD_REQUEST,isExtensionEnabled:e})})})},getStats=e=>{const{today:t,firstDayOfWeek:a,firstDayOfMonth:s}=getTimestamps();let n=0,o=0,i=0;for(let d=0;d<e.length;d++){const[r]=e[d];t<=r?n++:a<=r?o++:s<=r&&i++}return{videosSkipped:{today:n,week:o+=n,month:i+=o,total:e.length}}},updateUI=e=>{$("#total-count").innerText=e.videosSkipped.total,$("#today-count").innerText=e.videosSkipped.today,$("#this-week-count").innerText=e.videosSkipped.week,$("#this-month-count").innerText=e.videosSkipped.month,$("#isExtensionEnabledCb").checked=e.isExtensionEnabled},main=()=>{let e=initialData,t=[];chrome.storage.local.get(["savedData","savedSkippedAdsLogs"],({savedData:a,savedSkippedAdsLogs:s})=>{a&&(e=JSON.parse(a)),s?t=JSON.parse(s):saveData("savedSkippedAdsLogs",t);const{videosSkipped:n}=getStats(t);e.videosSkipped=n,saveData("savedData",e),updateUI(e)}),$("#isExtensionEnabledCb").addEventListener("change",({target:t})=>{e.isExtensionEnabled=t.checked,updateUI(e),saveData("savedData",e),askAllYoutubeTabsToReload(t.checked)}),$("#pictureInPlay").addEventListener("click",function(){this.classList.add("active"),chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.sendMessage(e[0].id,{messageType:MessageTypeEnum.REQUEST_PICTURE_IN_PLAY})})}),$("#more-controls-playSpeed-select").addEventListener("change",({target:e})=>{chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.tabs.sendMessage(t[0].id,{messageType:MessageTypeEnum.UPDATE_PLAY_SPEED,requestedSpeed:e.value})})})};window.addEventListener("load",main);